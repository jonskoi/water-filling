# ğŸ’§ Water-Filling Algorithm in OFDM Systems

OFDM ì‹œìŠ¤í…œì—ì„œëŠ” ì—¬ëŸ¬ ì„œë¸Œìºë¦¬ì–´(subcarrier)ë¥¼ ì‚¬ìš©í•´ ë™ì‹œì— ë°ì´í„°ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ ë¬´ì„  í†µì‹ ì—ì„œ **ì±„ë„ì˜ í’ˆì§ˆì€ ì£¼íŒŒìˆ˜ë§ˆë‹¤ ë‹¤ë¥´ë©°**, ì´ëŠ” ê³§ **ì„œë¸Œìºë¦¬ì–´ë§ˆë‹¤ SNRì´ ë‹¤ë¥´ë‹¤**ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

> ğŸ“Œ *ë¬¸ì œ*: **ì´ ì „ë ¥ì´ ì œí•œë˜ì–´ ìˆì„ ë•Œ**,  
> **ì–´ë–»ê²Œ ì „ë ¥ì„ ë¶„ë°°í•´ì•¼ ì „ì²´ ë°ì´í„° ì „ì†¡ë¥ (Capacity)ì„ ê·¹ëŒ€í™”í•  ìˆ˜ ìˆì„ê¹Œìš”?**

---

## ğŸ§  ì™œ ê· ë“± ë¶„ë°°ëŠ” ë¹„íš¨ìœ¨ì ì¼ê¹Œ?

ì„œë¸Œìºë¦¬ì–´ë§ˆë‹¤ **ì±„ë„ ì´ë“(Channel gain)** ì´ ë‹¤ë¦…ë‹ˆë‹¤.

ë”°ë¼ì„œ ë‹¨ìˆœíˆ ì „ë ¥ì„ `1/N`ë¡œ ë˜‘ê°™ì´ ë‚˜ëˆ„ë©´ ì¢‹ì€ ì±„ë„ì—ë„, ë‚˜ìœ ì±„ë„ì—ë„ ë™ì¼í•œ ì „ë ¥ì´ ë“¤ì–´ê°€ **ë¹„íš¨ìœ¨ì **ì…ë‹ˆë‹¤.

ì´ëŸ´ ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë°”ë¡œ **ì›Œí„°í•„ë§(Water-Filling) ì•Œê³ ë¦¬ì¦˜**ì…ë‹ˆë‹¤.

---

## ğŸ’§ Water-Filling ì´ë€?

â€œë¬¼ì„ ë¶“ëŠ”ë‹¤â€ëŠ” ë¹„ìœ ì—ì„œ ì´ë¦„ì´ ìœ ë˜ë˜ì—ˆìŠµë‹ˆë‹¤.

- ì—¬ëŸ¬ ê°œì˜ **ë†’ì´ê°€ ë‹¤ë¥¸ ì»µ** = ì„œë¸Œìºë¦¬ì–´ë“¤ì˜ ì±„ë„ ì—­ì´ë“ (1/gain)
- ì œí•œëœ ì–‘ì˜ **ë¬¼** = ì´ ì „ë ¥
- ê° ì»µì˜ ë†’ì´ì— ë”°ë¼ **ë¬¼ì„ ì±„ìš°ëŠ” ìˆ˜ì¤€** = ì „ë ¥ ë¶„ë°°

> ë‚®ì€ ì»µ(ì¢‹ì€ ì±„ë„)ë¶€í„° ë¨¼ì € ì±„ìš°ê³ , ë‚˜ë¨¸ì§€ì— ë”°ë¼ ë†’ì€ ì»µì—ë„ ì±„ìš´ë‹¤ëŠ” ê°œë…ì…ë‹ˆë‹¤.

---

## ğŸ§® ìµœì í™” ë¬¸ì œ ì •ì˜

ì´ Nê°œì˜ ì„œë¸Œìºë¦¬ì–´ì— ëŒ€í•´, ì„œë¸Œìºë¦¬ì–´ `k`ì˜ ì±„ë„ ì´ë“ì´ `gâ‚–`, ì „ë ¥ í• ë‹¹ëŸ‰ì´ `Îµâ‚–`ì¼ ë•Œ ë‹¤ìŒ ìµœì í™” ë¬¸ì œë¥¼ í’‰ë‹ˆë‹¤:

**(ìµœëŒ€í™” ëª©í‘œ)**

![Optimization Objective](https://github.com/user-attachments/assets/e5bef987-742d-4ccb-a5b2-dbb520c55866)

**ì œì•½ ì¡°ê±´**

- $\sum_k \varepsilon_k \leq E$
- $\varepsilon_k \geq 0$

> ğŸ”„ ì´ ë¬¸ì œëŠ” Concave Maximization â†’ Convex Minimizationìœ¼ë¡œ ë³€í™˜í•˜ì—¬ í’‰ë‹ˆë‹¤.

![Convex Form](https://github.com/user-attachments/assets/2d75afc5-5cb3-4df3-ac90-f99a5ead7874)

---

## ğŸ”§ KKT ì¡°ê±´ì„ í†µí•œ í•´ ë„ì¶œ

Lagrangian í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜ë©ë‹ˆë‹¤:

![Lagrangian](https://github.com/user-attachments/assets/fc87aef8-1e89-435d-89bd-44cb2b10ec5c)

Lagrangianì˜ Gradientë¥¼ êµ¬í•˜ê³ :

![Gradient](https://github.com/user-attachments/assets/17a3b48f-746c-4052-b27d-b6c6b4d51f59)

**Complementary Slackness** ì¡°ê±´ê³¼ ê²°í•©í•˜ì—¬, ë‹¤ìŒ ì‹ì„ ë§Œì¡±í•˜ëŠ” ê°’ì„ ì°¾ìŠµë‹ˆë‹¤:

![Complementary Slackness](https://github.com/user-attachments/assets/9e47de5f-c971-4974-b12e-c34093f9523b)

ê²°êµ­ ê° ì„œë¸Œìºë¦¬ì–´ì˜ ìµœì  ì „ë ¥ í• ë‹¹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

![Final Solution](https://github.com/user-attachments/assets/f9709ca3-1e45-43d5-b62b-d1673ecc7708)

ì›Œí„°ë ˆë²¨ $\mu$ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![Waterlevel](https://github.com/user-attachments/assets/8654743c-b35c-4f5c-ad5e-7016ab4284f3)

---

## ğŸ’» MATLAB ì‹œë®¬ë ˆì´ì…˜ ì½”ë“œ

### âœ… Energy Allocation with Water-Filling

ë¬´ì‘ìœ„ ì±„ë„ ì´ë“ì— ëŒ€í•´ 1000ë²ˆ ì‹œë®¬ë ˆì´ì…˜í•˜ì—¬ ì „ë ¥ ë¶„ë°° ê²°ê³¼ì™€ í‰ê·  ì „ì†¡ë¥ ì„ ê³„ì‚°í•©ë‹ˆë‹¤.

```matlab
% ì±„ë„ ì´ë“ gì™€ ë…¸ì´ì¦ˆ nì— ëŒ€í•´ waterfilling ì ìš©
% ì „ë ¥ ë¶„ë°° ê²°ê³¼ ì‹œê°í™” ë° ìš©ëŸ‰ ë¹„êµ
